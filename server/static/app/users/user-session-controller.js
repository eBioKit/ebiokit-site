(function(){var app=angular.module("users.controllers.user-session",["ang-dialogs","ui.router"]);app.controller("UserSessionController",function($state,$rootScope,$scope,$http,$dialogs,$cookies,APP_EVENTS){this.signFormSubmitHandler=function(){if($scope.isLogin){this.signInButtonHandler()}else{this.signUpButtonHandler()}};this.signInButtonHandler=function(){if($scope.userInfo.email!==""&&$scope.userInfo.password!==""){$http($rootScope.getHttpRequestConfig("POST","session-rest",{data:{token:btoa($scope.userInfo.email+":"+$scope.userInfo.password)}})).then(function successCallback(response){$cookies.remove("ebiokitsession",{path:getPathname()});$cookies.put("ebiokitsession",btoa($scope.userInfo.email+":"+response.data.session_token));$scope.userInfo.email=$scope.userInfo.email;delete $scope.userInfo.password;delete $scope.signForm;$rootScope.$broadcast(APP_EVENTS.loginSuccess);$state.go("control-panel")},function errorCallback(response){if(response.data&&[404001].indexOf(response.data.err_code)!==-1){$dialogs.showErrorDialog("Invalid user or password.");return}debugger;var message="Failed during sign-in process.";$dialogs.showErrorDialog(message,{logMessage:message+" at UserSessionController:signInButtonHandler."});console.error(response.data)})}};this.signUpButtonHandler=function(){if($scope.userInfo.email!==""&&$scope.userInfo.username!==""&&$scope.userInfo.password!==""&&$scope.userInfo.password===$scope.userInfo.passconfirm){$http($rootScope.getHttpRequestConfig("POST","user-rest",{data:$scope.userInfo})).then(function successCallback(response){if(response.data.success===true){$dialogs.showSuccessDialog("User account succesfully created.");$scope.isLogin=true}else{$dialogs.showErrorDialog("Invalid user or email address, perhaps this email account already exists.")}},function errorCallback(response){if(response.data&&[404001].indexOf(response.data.err_code)!==-1){$dialogs.showErrorDialog("Invalid user or password.");return}debugger;var message="Failed during sign-up process.";$dialogs.showErrorDialog(message,{logMessage:message+" at UserSessionController:signUpButtonHandler."});console.error(response.data)})}};this.signOutButtonHandler=function(){delete $scope.userInfo.email;$http($rootScope.getHttpRequestConfig("DELETE","session-rest",{data:{token:btoa($scope.userInfo.email+":"+$scope.userInfo.password)}})).then(function successCallback(response){$cookies.remove("ebiokitsession",{path:getPathname()});$state.go("signin");window.location.reload()},function errorCallback(response){$cookies.remove("ebiokitsession",{path:getPathname()});$state.go("signin");window.location.reload();var message="Failed during sign-out process.";$dialogs.showErrorDialog(message,{logMessage:message+" at UserSessionController:signOutButtonHandler."});console.error(response.data)});$rootScope.$broadcast(APP_EVENTS.logoutSuccess)};$scope.userInfo={email:""}})})();